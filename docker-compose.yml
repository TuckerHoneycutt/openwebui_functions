version: '3.8'

services:
  open-webui:
    build:
      context: .
      dockerfile: Dockerfile
      # Use --no-cache to ensure fresh build
      # args:
      #   BUILDKIT_INLINE_CACHE: "1"
    container_name: open-webui-template-formatter
    ports:
      - "3000:8080"
    volumes:
      # Persist OpenWebUI data
      - open-webui-data:/app/backend/data
      # Persist templates across container restarts
      - ./templates:/app/templates
      # Temp directory for generated PDFs
      - ./temp:/app/temp
      # Mount functions directory (if OpenWebUI uses a different location, adjust this)
      # Functions are also copied to /app/functions/ during build
      # Uncomment and adjust path if needed:
      # - ./functions:/app/functions
    environment:
      # Template storage directory (persisted via volume)
      - TEMPLATE_STORAGE_DIR=/app/templates
      # PDF temp directory
      - PDF_TEMP_DIR=/app/temp
      # Add other OpenWebUI environment variables as needed
      # - OLLAMA_BASE_URL=http://host.docker.internal:11434
    # Initialize functions on container start using a post-start approach
    # The init script will be run automatically via a startup hook
    # Alternative: Run manually after container starts: docker exec -it open-webui-template-formatter /app/init-template-functions.sh
    restart: unless-stopped

volumes:
  open-webui-data:
